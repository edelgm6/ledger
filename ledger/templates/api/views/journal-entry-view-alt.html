<h2>Journal Entries</h2>
<div id="table-and-form">
    <div id="transaction-store" data-transaction-ids="{{ transaction_ids|join:',' }}"></div>
    <div class="row">
        <div class="col-md-12">
            <div id="table">
                {{ table }}
            </div>
            <div id="form">
                {{ form }}
            </div>
        </div>
    </div>
</div>

{% include "api/components/clickable-row-script.html" %}
<script>
if (!window.hasAddedConfigRequestListener) {
    window.hasAddedConfigRequestListener = true;

    document.body.addEventListener("htmx:configRequest", function(event) {
        const ids = document.getElementById("transaction-store")?.dataset.transactionIds;
        if (!ids) return;

        if (!event.detail.parameters) {
            event.detail.parameters = {};
        }

        event.detail.parameters['transaction_ids'] = ids;
    });
}
</script>
<script>
if (!window.hasAddedAfterRequestListener) {
    window.hasAddedAfterRequestListener = true;

    document.body.addEventListener("htmx:afterRequest", function(event) {
        console.log('afterrequest');

        if (!event.detail.successful) return;

        const targetEl = event.target;
        if (!(targetEl instanceof HTMLFormElement) || targetEl.id !== "journal-entry-form") return;

        handleRowDelete();
    });
}
</script>
<script>
    function handleRowDelete() {
        console.log("run");
    
        const container = document.getElementById("transactions-table");
        const currentRow = container.querySelector("tr.table-active");
    
        if (!currentRow) return;
    
        const nextRow = currentRow.nextElementSibling;
    
        currentRow.remove();
    
        if (nextRow) {
            nextRow.classList.add("table-active");
            container.scrollTop = nextRow.offsetTop;
        } else {
            // No next row? Select the last row if it exists
            const allRows = container.querySelectorAll("tbody tr");
            
            if (allRows.length > 0) {
                const lastRow = allRows[allRows.length - 1];
                lastRow.classList.add("table-active");
                container.scrollTop = lastRow.offsetTop;
            } else {
                // If no rows exist, clear the table (optional)
                console.log("No rows left in the table.");
            }
        }

    }
</script>