<script>
$(document).ready(function() {
    // Function to calculate and format totals
    function calculateTotals() {
        let totalDebits = 0;
        let totalCredits = 0;

        // Calculate total for debits
        $('[name^="debits-"][name$="-amount"]').each(function() {
            let value = $(this).val().replace(/,/g, ''); // Remove commas
            totalDebits += parseFloat(value) || 0;
        });

        // Calculate total for credits
        $('[name^="credits-"][name$="-amount"]').each(function() {
            let value = $(this).val().replace(/,/g, ''); // Remove commas
            totalCredits += parseFloat(value) || 0;
        });

        // Calculate deltas
        let deltaDebits = totalDebits - totalCredits;
        let deltaCredits = totalCredits - totalDebits;

        // Format totals with relative delta
        $('#totalDebits').text(
            totalDebits.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) +
            ` (${deltaDebits >= 0 ? "+" : ""}${deltaDebits.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })})`
        );

        $('#totalCredits').text(
            totalCredits.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) +
            ` (${deltaCredits >= 0 ? "+" : ""}${deltaCredits.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })})`
        );

        console.log("Debits:", totalDebits, "Credits:", totalCredits);
        console.log("Delta Debits:", deltaDebits, "Delta Credits:", deltaCredits);
    }

    // Attach event listener for input on amount fields
    $('#journal-entry-form').on('input', '[name$="-amount"]', function() {
        calculateTotals();
    });
});
</script>
